VERSION=8.10.1
NAMESPACE=my-elk-stack

----

version: '3.3'

services:
  metricbeat:
    image: "docker.elastic.co/beats/metricbeat:${VERSION}"
    container_name: "${NAMESPACE}_metricbeat"
    user: root
    volumes:
      - ./config/metricbeat.yml:/etc/metricbeat/metricbeat.yml:ro
      - /sys/fs/cgroup:/hostfs/sys/fs/cgroup:ro
      - /proc:/hostfs/proc:ro
      - /:/hostfs:ro
    network_mode: host

  filebeat:
    image: "docker.elastic.co/beats/filebeat:${VERSION}"
    container_name: "${NAMESPACE}_filebeat"
    user: root
    volumes:
      - ./config/filebeat.yml:/etc/filebeat/filebeat.yml:ro
      - /var/log:/usr/share/filebeat/logs:ro
    network_mode: host

  heartbeat:
    image: "docker.elastic.co/beats/heartbeat:${VERSION}"
    container_name: "${NAMESPACE}_heartbeat"
    volumes:
      - ./config/heartbeat.yml:/etc/heartbeat/heartbeat.yml:ro
    network_mode: host

  auditbeat:
    image: "docker.elastic.co/beats/auditbeat:${VERSION}"
    container_name: "${NAMESPACE}_auditbeat"
    user: root
    volumes:
      - ./config/auditbeat.yml:/etc/auditbeat/auditbeat.yml:ro
      - /proc:/hostfs/proc:ro
      - /:/hostfs:ro
    network_mode: host

x-logging:
  options:
    max-size: "10m"
    max-file: "5"

logging:
  driver: "json-file"
  options:
    max-size: "10m"
    max-file: "5"
-----
output.elasticsearch:
  hosts: ["http://elasticsearch-host:9200"]
  username: "elastic"
  password: "your_password"

setup.kibana:
  host: "http://kibana-host:5601"

metricbeat.modules:
- module: system
  metricsets:
    - cpu
    - memory
    - network
    - diskio
    - load
  enabled: true
  period: 10s
  processors:
    - add_host_metadata: ~
    - add_cloud_metadata: ~
    - add_docker_metadata: ~

---

output.elasticsearch:
  hosts: ["http://elasticsearch-host:9200"]
  username: "elastic"
  password: "your_password"

setup.kibana:
  host: "http://kibana-host:5601"

filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/*.log
    - /var/log/syslog
    - /var/log/auth.log

processors:
  - add_host_metadata: ~
  - add_cloud_metadata: ~
  - add_docker_metadata: ~
---

output.elasticsearch:
  hosts: ["http://elasticsearch-host:9200"]
  username: "elastic"
  password: "your_password"

setup.kibana:
  host: "http://kibana-host:5601"

heartbeat.monitors:
- type: http
  schedule: '@every 30s'
  urls: ["http://your-service.com", "http://another-service.com"]
  check.response:
    status: 200
- type: icmp
  schedule: '@every 60s'
  hosts: ["8.8.8.8", "8.8.4.4"]
---
output.elasticsearch:
  hosts: ["http://elasticsearch-host:9200"]
  username: "elastic"
  password: "your_password"

setup.kibana:
  host: "http://kibana-host:5601"

auditbeat.modules:
- module: auditd
  audit_rules: |
    -a always,exit -F arch=b64 -S all -F key=64bit-abi
    -a always,exit -F arch=b32 -S all -F key=32bit-abi

- module: file_integrity
  paths:
    - /bin
    - /usr/bin
    - /sbin
    - /usr/sbin
    - /etc
    - /var/log

processors:
  - add_host_metadata: ~
  - add_cloud_metadata: ~


